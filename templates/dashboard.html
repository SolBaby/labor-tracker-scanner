{% extends "base.html" %}

{% block content %}
<h1>Real-time Analytics Dashboard</h1>

<div id="dashboard-data">
    <div class="metric">
        <h2>Active Employees</h2>
        <p id="active-employees">{{ active_employees }}</p>
    </div>
    <div class="metric">
        <h2>Completed Tasks</h2>
        <p id="completed-tasks">{{ completed_tasks }}</p>
    </div>
    <div class="metric">
        <h2>Average Task Duration</h2>
        <p id="avg-task-duration">{{ avg_task_duration }}</p>
    </div>
    <div class="metric">
        <h2>Top 5 Productive Employees</h2>
        <ul id="top-employees">
        {% for employee in top_employees %}
            <li>{{ employee.name }} - {{ employee.total_duration }}</li>
        {% endfor %}
        </ul>
    </div>
</div>

<script>
function updateDashboard() {
    fetch('/api/dashboard/data')
        .then(response => response.json())
        .then(data => {
            document.getElementById('active-employees').textContent = data.active_employees;
            document.getElementById('completed-tasks').textContent = data.completed_tasks;
            document.getElementById('avg-task-duration').textContent = data.avg_task_duration;
            
            const topEmployeesList = document.getElementById('top-employees');
            topEmployeesList.innerHTML = '';
            data.top_employees.forEach(employee => {
                const li = document.createElement('li');
                li.textContent = `${employee.name} - ${employee.duration}`;
                topEmployeesList.appendChild(li);
            });
        });
}

// Update dashboard every 30 seconds
setInterval(updateDashboard, 30000);
</script>
{% endblock %}
